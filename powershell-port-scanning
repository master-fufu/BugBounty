$adress = "10.64.188.4";$Ports = 1 .. 65535;$TimeOut = 20;$ping = New-Object System.Net.Networkinformation.Ping;$pingStatus = $ping.Send($adress,$TimeOut);if($pingStatus.Status -eq "Success"){$openPorts = @();for($i = 1; $i -le $ports.Count;$i++) {$port = $Ports[($i-1)];write-progress -activity PortScan -status $adress -percentcomplete (($i/($Ports.Count)) * 100) -Id 2;       $client = New-Object System.Net.Sockets.TcpClient;$beginConnect = $client.BeginConnect($pingStatus.Address,$port,$null,$null);if($client.Connected){$openPorts += $port;} else { Start-Sleep -Milli $TimeOut;if($client.Connected) { $openPorts += $port;$Message = "dsec_search_port----------------------------------port=$port";$socket = new-object System.Net.Sockets.TcpClient($adress, $port);$data = [System.Text.Encoding]::ASCII.GetBytes($message);$stream = $socket.GetStream();$stream.Write($data, 0, $data.Length); }}$client.Close()};New-Object PSObject -Property @{Ports = $openPorts} | Select-Object  Ports | Out-File -filepath .\out.txt;}
